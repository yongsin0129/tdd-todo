● 📊 E2E 測試執行結果報告

  ✅ 測試通過情況

  通過率: 6/10 (60%)

  | 測試編號   | 測試名稱                                 | 狀態   |
  |--------|--------------------------------------|------|
  | E2E-1  | should successfully add a new todo   | ✅ 通過 |
  | E2E-2  | should display all todos             | ❌ 失敗 |
  | E2E-3  | should toggle todo completion status | ❌ 失敗 |
  | E2E-4  | should edit todo                     | ✅ 通過 |
  | E2E-5  | should delete todo                   | ❌ 失敗 |
  | E2E-6  | should filter todos                  | ❌ 失敗 |
  | E2E-7  | should reject empty title            | ✅ 通過 |
  | E2E-8  | should persist todos to localStorage | ✅ 通過 |
  | E2E-9  | should support keyboard shortcuts    | ✅ 通過 |
  | E2E-10 | should work on mobile                | ✅ 通過 |

  ---
  ❌ 失敗測試分析

  1. should display all todos (E2E-2)

  錯誤: strict mode violation: getByText('Write code') resolved to 2 elements

  原因: 待辦事項出現重複項目（重複 2 次）

  根本原因: 前端同時使用 LocalStorage 和後端 API，造成雙重儲存：
  - useTodos hook 會從後端 fetch todos
  - todoStore 也會從 localStorage 載入
  - 導致同一個 todo 出現兩次

  ---
  2. should toggle todo completion status (E2E-3)

  錯誤: Expected: checked, Timeout: 5000ms, Error: element(s) not found

  原因: Checkbox 點擊後，狀態未正確更新

  可能原因:
  1. API 呼叫失敗或超時
  2. 樂觀更新後沒有等待 API 完成
  3. 多個重複項目導致選擇器混淆

  ---
  3. should delete todo (E2E-5)

  錯誤: getByText(/no todos yet/i) Expected: visible, Error: element(s) not found

  原因: 刪除後沒有顯示空狀態訊息

  可能原因:
  - 因為有重複項目，刪除一個後還有另一個
  - 空狀態訊息的條件判斷錯誤

  ---
  4. should filter todos (E2E-6)

  錯誤: getByRole('button', { name: /todo: active task 2/i }) Expected: visible, Error: element(s) not found

  原因: 篩選後找不到第二個待辦事項

  可能原因:
  - API 呼叫過快，某些項目還沒新增完成
  - 重複項目導致資料混亂

  ---
  🔍 核心問題：資料同步架構問題

  你的應用目前有兩個資料來源衝突：

  // 1. LocalStorage (舊的方式)
  todoStore.ts 會儲存到 localStorage

  // 2. Backend API (新的方式)
  useTodos hook 會呼叫後端 API

  // 結果: 同一個 todo 出現兩次!

  ---
  💡 建議修正方案

  選項 A: 只使用後端 API（推薦）

  移除 localStorage 同步，完全依賴後端：

  // 在 todoStore.ts 中移除 localStorage middleware
  // 只依賴 useTodos hook 從後端 fetch 資料

  選項 B: 只使用 LocalStorage

  移除後端 API 整合，純前端應用：

  // 移除 useTodos hook 的 API 呼叫
  // 只使用 todoStore 的 localStorage

  選項 C: 智慧同步（複雜）

  實作真正的離線優先架構，確保 localStorage 和 API 同步：
  - 使用唯一 ID 避免重複
  - 實作衝突解決機制
  - 定期同步檢查

  ---
  📝 下一步建議

  1. 決定資料來源策略 - 選擇 A、B 或 C
  2. 修正資料同步問題 - 確保不會有重複項目
  3. 增加等待時間 - 某些測試需要等待 API 完成
  4. 重新執行測試 - 確認問題解決